<template>
    <!-- Asset Selector Component -->
    <div class="asset-selector-container">
        <!-- Context Pill (shows selected location) -->
        <template if:true={hasLocationContext}>
            <div class="slds-m-bottom_medium">
                <div class="slds-pill_container">
                    <span class="slds-pill">
                        <lightning-icon
                            icon-name="standard:account"
                            size="x-small"
                            class="slds-m-right_xx-small">
                        </lightning-icon>
                        <span class="slds-pill__label">
                            Searching assets for: {locationName}
                        </span>
                    </span>
                </div>
            </div>
        </template>

        <!-- Multi-Asset Selection Info -->
        <template if:true={allowMultiSelect}>
            <div class="slds-m-bottom_medium">
                <div class="slds-notify slds-notify_alert slds-alert_info" role="alert">
                    <lightning-icon icon-name="utility:info" size="x-small" variant="info" class="slds-m-right_x-small"></lightning-icon>
                    <div>
                        <h2>
                            <strong>Multi-Asset Selection</strong>
                        </h2>
                        <p>You can select multiple assets. Selected: {selectedAssetCount}</p>
                    </div>
                </div>
            </div>
        </template>

        <!-- Recent Assets (Quick Selection) -->
        <template if:true={showRecentAssets}>
            <div class="slds-m-bottom_medium">
                <div class="slds-card">
                    <div class="slds-card__header slds-border_bottom">
                        <h3 class="slds-text-heading_small">Recently Selected Assets</h3>
                    </div>
                    <div class="slds-card__body slds-card__body_inner">
                        <template if:true={hasRecentAssets}>
                            <div class="recent-assets-grid">
                                <template for:each={recentAssets} for:item="asset">
                                    <lightning-button
                                        key={asset.id}
                                        label={asset.acornSID}
                                        title={asset.name}
                                        variant="neutral"
                                        onclick={handleRecentAssetClick}
                                        data-id={asset.id}
                                        class="slds-m-right_x-small slds-m-bottom_x-small">
                                    </lightning-button>
                                </template>
                            </div>
                        </template>
                        <template if:false={hasRecentAssets}>
                            <p class="slds-text-color_weak">No recently selected assets</p>
                        </template>
                    </div>
                </div>
            </div>
        </template>

        <!-- Search Component -->
        <c-record-search-base
            search-title="Search Assets"
            icon-name="standard:service_contract"
            search-fields={searchFields}
            columns={columns}
            show-radio-select={showRadioSelect}
            show-create-new={false}
            show-pagination={true}
            onsearch={handleSearch}
            onrecordselect={handleRecordSelect}
            onrecordclick={handleRecordClick}
            onclear={handleClear}
            onerror={handleError}>
        </c-record-search-base>

        <!-- Selected Asset Detail Card -->
        <template if:true={hasSelectedAsset}>
            <div class="slds-m-top_medium">
                <c-inline-detail-card
                    title={selectedAssetTitle}
                    icon-name="standard:service_contract"
                    fields={selectedAssetFields}
                    variant="base"
                    is-visible={true}
                    show-close-button={false}
                    has-footer={false}>
                </c-inline-detail-card>
            </div>
        </template>

        <!-- Selected Assets Table (Multi-Select) -->
        <template if:true={hasMultipleSelectedAssets}>
            <div class="slds-m-top_medium">
                <div class="slds-card">
                    <div class="slds-card__header slds-border_bottom">
                        <h3 class="slds-text-heading_small">Selected Assets ({selectedAssetCount})</h3>
                    </div>
                    <div class="slds-card__body slds-card__body_inner">
                        <table class="slds-table slds-table_bordered slds-table_cell-buffer">
                            <thead>
                                <tr class="slds-line-height_reset">
                                    <th scope="col"><div class="slds-truncate">Action</div></th>
                                    <th scope="col"><div class="slds-truncate">SID</div></th>
                                    <th scope="col"><div class="slds-truncate">Name</div></th>
                                    <th scope="col"><div class="slds-truncate">Material Type</div></th>
                                    <th scope="col"><div class="slds-truncate">Schedule</div></th>
                                </tr>
                            </thead>
                            <tbody>
                                <template for:each={selectedAssets} for:item="asset">
                                    <tr key={asset.id} class="slds-hint-parent">
                                        <td>
                                            <lightning-button
                                                variant="destructive"
                                                label="Remove"
                                                onclick={handleRemoveAsset}
                                                data-id={asset.id}
                                                size="small">
                                            </lightning-button>
                                        </td>
                                        <td><div class="slds-truncate">{asset.acornSID}</div></td>
                                        <td><div class="slds-truncate">{asset.name}</div></td>
                                        <td><div class="slds-truncate">{asset.materialType}</div></td>
                                        <td><div class="slds-truncate">{asset.schedule}</div></td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </template>

        <!-- Loading Spinner -->
        <template if:true={isLoading}>
            <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
        </template>
    </div>
</template>
